-- a. Create a table Films
CREATE TABLE Films(
    FID BIGINT PRIMARY KEY,
    TITLE VARCHAR(200) NOT NULL,
    PROD_YEAR BIGINT NOT NULL,
    RATING REAL NOT NULL CHECK (RATING BETWEEN 0 AND 10)
);



-- b. Create a table AnnualSummary
CREATE TABLE AnnualSummary(
    PROD_YEAR BIGINT NOT NULL PRIMARY KEY,
    FID BIGINT NOT NULL Foreign Key (FID) REFERENCES (Films),
    RATED_ABOVE_8 BIGINT NOT NULL CHECK (RATED_ABOVE_8 >8)
);

-- c. Create a trigger AutoAddFID
CREATE TRIGGER AutoAddFID
ON Films
INSTEAD OF INSERT
AS
BEGIN
  SET NOCOUNT ON;

  ;WITH next_id AS (
    SELECT COALESCE(MAX(FID), -1) + 1 AS start_id
    FROM Films
  ),
  ins AS (
    SELECT ROW_NUMBER() OVER (ORDER BY (SELECT 1)) - 1 AS rn,
           TITLE, PROD_YEAR, RATING
    FROM inserted
  )
  INSERT INTO Films (FID, TITLE, PROD_YEAR, RATING)
  SELECT n.start_id + i.rn, i.TITLE, i.PROD_YEAR, i.RATING
  FROM ins i CROSS JOIN next_id n;
END




-- d. Create a function GetBestFilm
RETURNS BIGINT
AS
BEGIN
    DECLARE @BestFilmID BIGINT

    SELECT @BestFilmID = FID
    FROM Films
    WHERE PROD_YEAR = @P_YEAR AND RATING = (
        SELECT MAX(RATING)
        FROM Films
        WHERE PROD_YEAR = @P_YEAR
    )

    RETURN @BestFilmID
END



-- e. Create a function GetNumAbove8
RETURN BIGINT 
AS



-- f. Create a procedure AddSummaryItems
